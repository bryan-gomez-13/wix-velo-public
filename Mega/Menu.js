const MEET = {
    _id: 'meat',
    label: 'Meet',
    menuItems: [{
            _id: 'mexican',
            label: 'Mexican',
            menuItems: [{
                _id: 'taco',
                label: 'Taco',
                ingredients: [{
                        _id: 'tortillas',
                        label: 'Tortillas',
                        image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTJcM50pbjm2jERNPv_wH4FBHpAH55FEkYVpj2wJeP-SNnfS565mVxQ8odh0uhgwSIHlqs&usqp=CAU'
                    },
                    {
                        _id: 'grilled-meat',
                        label: 'Grilled meat (chicken, beef, pork, etc.)',
                        image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQGSloeovSRG_JSx-Qlnz2qnRJgNTDZoNtQ2Bv1szT0XdYO6Y9WiwUd4Nkp3rlW7VgCABw&usqp=CAU'
                    },
                    {
                        _id: 'salsa',
                        label: 'Salsa',
                        image: 'https://upload.wikimedia.org/wikipedia/commons/6/6d/Good_Food_Display_-_NCI_Visuals_Online.jpg'
                    },
                    {
                        _id: 'chopped-onions',
                        label: 'Chopped onions',
                        image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSrlbqCksAwdSudncLuujP-5-bredZYRObHBjbTUfFpBnptaZFg1obGB4z9d2DC0ECxu3s&usqp=CAU'
                    },
                    {
                        _id: 'chopped-cilantro',
                        label: 'Chopped cilantro',
                        image: 'https://img.freepik.com/free-photo/chicken-wings-barbecue-sweetly-sour-sauce-picnic-summer-menu-tasty-food-top-view-flat-lay_2829-6471.jpg?w=2000'
                    },
                    {
                        _id: 'lime-wedges',
                        label: 'Lime wedges',
                        image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSrlbqCksAwdSudncLuujP-5-bredZYRObHBjbTUfFpBnptaZFg1obGB4z9d2DC0ECxu3s&usqp=CAU'
                    },
                    {
                        _id: 'cheese',
                        label: 'Cheese',
                        image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ21ljrrJ61iO27RROHWR5h3pxZwyUDnYrc4nNJ0qDIra-Bs1-NvU4Qxd8R2w74FH-wGrw&usqp=CAU'
                    },
                    {
                        _id: 'sour-cream',
                        label: 'Sour cream',
                        image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQGSloeovSRG_JSx-Qlnz2qnRJgNTDZoNtQ2Bv1szT0XdYO6Y9WiwUd4Nkp3rlW7VgCABw&usqp=CAU'
                    }
                ]
            }, {
                _id: 'chilaquiles',
                label: 'Chilaquiles',
                ingredients: [{
                        _id: 'tortilla-chips',
                        label: 'Tortilla chips',
                    },
                    {
                        _id: 'red-green-salsa',
                        label: 'Red or green salsa',
                    },
                    {
                        _id: 'shredded-chicken-beef',
                        label: 'Shredded chicken or beef',
                    },
                    {
                        _id: 'cheese',
                        label: 'Cheese',
                    },
                    {
                        _id: 'sour-cream',
                        label: 'Sour cream',
                    },
                    {
                        _id: 'chopped-onions',
                        label: 'Chopped onions',
                    },
                    {
                        _id: 'chopped-cilantro',
                        label: 'Chopped cilantro',
                    }
                ]
            }, {
                _id: 'pozole',
                label: 'Pozole',
                ingredients: [{
                        _id: 'hominy-corn',
                        label: 'Hominy corn',
                    },
                    {
                        _id: 'pork-chicken',
                        label: 'Pork or chicken',
                    },
                    {
                        _id: 'chicken-broth',
                        label: 'Chicken broth',
                    },
                    {
                        _id: 'chopped-onions',
                        label: 'Chopped onions',
                    },
                    {
                        _id: 'chopped-cilantro',
                        label: 'Chopped cilantro',
                    },
                    {
                        _id: 'lime-wedges',
                        label: 'Lime wedges',
                    },
                    {
                        _id: 'cabbage',
                        label: 'Cabbage',
                    },
                    {
                        _id: 'radishes',
                        label: 'Radishes',
                    },
                    {
                        _id: 'dried-oregano',
                        label: 'Dried oregano',
                    },
                    {
                        _id: 'red-chili-flakes',
                        label: 'Red chili flakes',
                    }
                ]
            }]
        },
        {
            _id: 'israeli',
            label: 'Israeli',
            menuItems: [{
                _id: 'sabich-sandwich',
                label: 'Sabich Sandwich',
                ingredients: [{
                        _id: 'pita-bread',
                        label: 'Pita bread',
                    },
                    {
                        _id: 'fried-eggplant-slices',
                        label: 'Fried eggplant slices',
                    },
                    {
                        _id: 'hard-boiled-eggs',
                        label: 'Hard-boiled eggs',
                    },
                    {
                        _id: 'israeli-salad',
                        label: 'Israeli salad (tomatoes, cucumbers, onions)',
                    },
                    {
                        _id: 'tahini-sauce',
                        label: 'Tahini sauce',
                    },
                    {
                        _id: 'amba-sauce',
                        label: 'Amba sauce (mango pickle)',
                    },
                    {
                        _id: 'chopped-parsley',
                        label: 'Chopped parsley',
                    }
                ]
            }, {
                _id: 'falafel',
                label: 'Falafel',
                ingredients: [{
                        _id: 'chickpeas',
                        label: 'Chickpeas',
                    },
                    {
                        _id: 'onion',
                        label: 'Onion',
                    },
                    {
                        _id: 'garlic',
                        label: 'Garlic',
                    },
                    {
                        _id: 'fresh-herbs',
                        label: 'Fresh herbs (parsley, cilantro)',
                    },
                    {
                        _id: 'spices',
                        label: 'Spices (cumin, coriander)',
                    },
                    {
                        _id: 'flour-breadcrumbs',
                        label: 'Flour or breadcrumbs',
                    },
                    {
                        _id: 'baking-powder',
                        label: 'Baking powder',
                    },
                    {
                        _id: 'tahini-sauce',
                        label: 'Tahini sauce',
                    },
                    {
                        _id: 'pita-bread',
                        label: 'Pita bread',
                    }
                ]
            }, {
                _id: 'hummus',
                label: 'Hummus',
                ingredients: [{
                        _id: 'chickpeas',
                        label: 'Chickpeas',
                    },
                    {
                        _id: 'tahini',
                        label: 'Tahini',
                    },
                    {
                        _id: 'lemon-juice',
                        label: 'Lemon juice',
                    },
                    {
                        _id: 'garlic',
                        label: 'Garlic',
                    },
                    {
                        _id: 'olive-oil',
                        label: 'Olive oil',
                    },
                    {
                        _id: 'ground-cumin',
                        label: 'Ground cumin',
                    },
                    {
                        _id: 'salt',
                        label: 'Salt',
                    },
                    {
                        _id: 'paprika',
                        label: 'Paprika',
                    },
                    {
                        _id: 'pita-bread-vegetables',
                        label: 'Pita bread or vegetables (for dipping)',
                    }
                ]
            }]
        }
    ]
};

const VEGAN = {
    _id: 'vegan',
    label: 'Vegan',
    menuItems: [{
            _id: 'indian',
            label: 'Indian',
            menuItems: [{
                    _id: 'chana-masala',
                    label: 'Chana Masala',
                    ingredients: [
                        { _id: 'chickpeas', label: 'Chickpeas' },
                        { _id: 'tomatoes', label: 'Tomatoes' },
                        { _id: 'onion', label: 'Onion' },
                        { _id: 'garlic', label: 'Garlic' },
                        { _id: 'ginger', label: 'Ginger' },
                        { _id: 'spices', label: 'Spices (cumin, coriander, garam masala)' },
                        { _id: 'lemon-juice', label: 'Lemon juice' },
                        { _id: 'fresh-cilantro', label: 'Fresh cilantro' }
                    ]
                },
                {
                    _id: 'aloo-gobi',
                    label: 'Aloo Gobi',
                    ingredients: [
                        { _id: 'potatoes', label: 'Potatoes' },
                        { _id: 'cauliflower', label: 'Cauliflower' },
                        { _id: 'onion', label: 'Onion' },
                        { _id: 'tomatoes', label: 'Tomatoes' },
                        { _id: 'spices', label: 'Spices (turmeric, cumin, coriander)' },
                        { _id: 'green-chili', label: 'Green chili' },
                        { _id: 'ginger', label: 'Ginger' },
                        { _id: 'fresh-cilantro', label: 'Fresh cilantro' }
                    ]
                }
            ]
        },
        {
            _id: 'italian',
            label: 'Italian',
            menuItems: [{
                    _id: 'pasta-primavera',
                    label: 'Pasta Primavera',
                    ingredients: [
                        { _id: 'pasta', label: 'Pasta' },
                        { _id: 'assorted-vegetables', label: 'Assorted vegetables (bell peppers, zucchini, carrots)' },
                        { _id: 'olive-oil', label: 'Olive oil' },
                        { _id: 'garlic', label: 'Garlic' },
                        { _id: 'cherry-tomatoes', label: 'Cherry tomatoes' },
                        { _id: 'fresh-basil', label: 'Fresh basil' },
                        { _id: 'lemon-zest', label: 'Lemon zest' }
                    ]
                },
                {
                    _id: 'eggplant-parmesan',
                    label: 'Eggplant Parmesan',
                    ingredients: [
                        { _id: 'eggplant', label: 'Eggplant' },
                        { _id: 'bread-crumbs', label: 'Bread crumbs' },
                        { _id: 'marinara-sauce', label: 'Marinara sauce' },
                        { _id: 'vegan-cheese', label: 'Vegan cheese' },
                        { _id: 'olive-oil', label: 'Olive oil' },
                        { _id: 'garlic', label: 'Garlic' },
                        { _id: 'fresh-basil', label: 'Fresh basil' }
                    ]
                }
            ]
        }
    ]
};

const MILKY = {
    _id: 'milky',
    label: 'Milky',
    menuItems: [{
            _id: 'italian',
            label: 'Italian',
            menuItems: [{
                    _id: 'tiramisu',
                    label: 'Tiramisu',
                    ingredients: [
                        { _id: 'ladyfingers', label: 'Ladyfingers' },
                        { _id: 'espresso', label: 'Espresso' },
                        { _id: 'mascarpone-cheese', label: 'Mascarpone cheese' },
                        { _id: 'cocoa-powder', label: 'Cocoa powder' },
                        { _id: 'whipped-cream', label: 'Whipped cream' }
                    ]
                },
                {
                    _id: 'panna-cotta',
                    label: 'Panna Cotta',
                    ingredients: [
                        { _id: 'heavy-cream', label: 'Heavy cream' },
                        { _id: 'sugar', label: 'Sugar' },
                        { _id: 'vanilla-extract', label: 'Vanilla extract' },
                        { _id: 'gelatin', label: 'Gelatin' },
                        { _id: 'fruit-sauce', label: 'Fruit sauce' }
                    ]
                }
            ]
        },
        {
            _id: 'french',
            label: 'French',
            menuItems: [{
                    _id: 'creme-brulee',
                    label: 'Crème Brûlée',
                    ingredients: [
                        { _id: 'heavy-cream', label: 'Heavy cream' },
                        { _id: 'vanilla-bean', label: 'Vanilla bean' },
                        { _id: 'egg-yolks', label: 'Egg yolks' },
                        { _id: 'sugar', label: 'Sugar' },
                        { _id: 'brown-sugar', label: 'Brown sugar (for caramelization)' }
                    ]
                },
                {
                    _id: 'mille-feuille',
                    label: 'Mille-Feuille',
                    ingredients: [
                        { _id: 'puff-pastry', label: 'Puff pastry' },
                        { _id: 'pastry-cream', label: 'Pastry cream' },
                        { _id: 'powdered-sugar', label: 'Powdered sugar' },
                        { _id: 'raspberries', label: 'Raspberries' },
                        { _id: 'mint-leaves', label: 'Fresh mint leaves' }
                    ]
                }
            ]
        },
        {
            _id: 'japanese',
            label: 'Japanese',
            menuItems: [{
                    _id: 'matcha-latte',
                    label: 'Matcha Latte',
                    ingredients: [
                        { _id: 'matcha-powder', label: 'Matcha powder' },
                        { _id: 'hot-water', label: 'Hot water' },
                        { _id: 'plant-milk', label: 'Plant-based milk' },
                        { _id: 'sweetener', label: 'Sweetener (optional)' }
                    ]
                },
                {
                    _id: 'mochi-ice-cream',
                    label: 'Mochi Ice Cream',
                    ingredients: [
                        { _id: 'mochi', label: 'Mochi dough' },
                        { _id: 'ice-cream', label: 'Vegan ice cream' },
                        { _id: 'cornstarch', label: 'Cornstarch (for dusting)' }
                    ]
                }
            ]
        },
        {
            _id: 'indian',
            label: 'Indian',
            menuItems: [{
                    _id: 'kulfi',
                    label: 'Kulfi',
                    ingredients: [
                        { _id: 'condensed-milk', label: 'Condensed milk' },
                        { _id: 'almond-milk', label: 'Almond milk' },
                        { _id: 'cardamom', label: 'Cardamom' },
                        { _id: 'pistachios', label: 'Pistachios' },
                        { _id: 'saffron', label: 'Saffron strands' }
                    ]
                },
                {
                    _id: 'coconut-ladoo',
                    label: 'Coconut Ladoo',
                    ingredients: [
                        { _id: 'coconut', label: 'Desiccated coconut' },
                        { _id: 'condensed-milk', label: 'Condensed milk' },
                        { _id: 'cardamom', label: 'Cardamom' },
                        { _id: 'nuts', label: 'Assorted nuts' }
                    ]
                }
            ]
        },
        {
            _id: 'american',
            label: 'American',
            menuItems: [{
                    _id: 'vegan-cheesecake',
                    label: 'Vegan Cheesecake',
                    ingredients: [
                        { _id: 'cashews', label: 'Cashews' },
                        { _id: 'coconut-milk', label: 'Coconut milk' },
                        { _id: 'maple-syrup', label: 'Maple syrup' },
                        { _id: 'lemon-juice', label: 'Lemon juice' },
                        { _id: 'vanilla-extract', label: 'Vanilla extract' },
                        { _id: 'crust-ingredients', label: 'Crust ingredients (graham crackers, nuts, dates)' }
                    ]
                },
                {
                    _id: 'chocolate-mousse',
                    label: 'Chocolate Mousse',
                    ingredients: [
                        { _id: 'avocado', label: 'Avocado' },
                        { _id: 'cocoa-powder', label: 'Cocoa powder' },
                        { _id: 'maple-syrup', label: 'Maple syrup' },
                        { _id: 'vanilla-extract', label: 'Vanilla extract' },
                        { _id: 'plant-milk', label: 'Plant-based milk' }
                    ]
                }
            ]
        }
    ]
};

const SPICY = {
    _id: 'spicy',
    label: 'Spicy',
};

const Menu = [
    MEET,
    VEGAN,
    MILKY,
    SPICY
]

$w.onReady(function () {
    initMenuRepeaters();
    initMenu();
});

function initMenu() {
    const mainMenuRep = $w('#mainMenuRepeater');

    const mainMenuData = [];
    for (const obj in Menu) {
        const mainMenuItem = Menu[obj];
        mainMenuData.push(mainMenuItem)
    }

    console.log('Main Menu data: ', mainMenuData)
    mainMenuRep.data = mainMenuData;

    //*** Close Dropdown Menu ***//
    $w('#menuMainWrapper').onMouseOut(() => {
        closeDropdownMenu();
    });
}

async function openDropdownMenu() {
    $w('#subMenuContainer').customClassList.add('dropdown-menu-expand');
}

async function closeDropdownMenu() {
    $w('#subMenuContainer').customClassList.remove('dropdown-menu-expand');
}

function initMenuRepeaters() {
    const mainMenuRepeater = $w('#mainMenuRepeater');
    const firstLevelMenuRepeater = $w('#firstLevelRepeater');
    const secondLevelMenuRepeater = $w('#secondLevelRepeater');
    const thirdLevelMenuRepeater = $w('#thirdLevelRepeater');

    mainMenuRepeater.data = [];
    firstLevelMenuRepeater.data = [];
    secondLevelMenuRepeater.data = [];
    thirdLevelMenuRepeater.data = [];

    mainMenuRepeater.onItemReady(($item, itemData) => {
        const mainMenuBtn = $item('#mainMenuRepItemBtn');
        mainMenuBtn.label = itemData.label;

        mainMenuBtn.onMouseIn(() => {
            if (itemData.menuItems) {
                firstLevelMenuRepeater.data = itemData.menuItems; // Settings the next level repeater data
                secondLevelMenuRepeater.data = [];
                thirdLevelMenuRepeater.data = [];
                openDropdownMenu();
            } else {
                closeDropdownMenu();
            }
            activMainMenuBtn(itemData._id);
        });
    });

    firstLevelMenuRepeater.onItemReady(($item, itemData) => {
        const mainMenuBtn = $item('#firstLevelRepBtn');
        mainMenuBtn.label = itemData.label;

        mainMenuBtn.onMouseIn(() => {
            if (itemData.menuItems) {
                secondLevelMenuRepeater.data = itemData.menuItems; // Settings the next level repeater data
                thirdLevelMenuRepeater.data = [];
            }
            activFirstLevelRepMenuBtn(itemData._id);
        });
    });

    secondLevelMenuRepeater.onItemReady(($item, itemData) => {
        const mainMenuBtn = $item('#secondLevelRepBtn');
        mainMenuBtn.label = itemData.label;

        mainMenuBtn.onMouseIn(() => {
            if (itemData.ingredients) {
                thirdLevelMenuRepeater.data = itemData.ingredients; // Settings the next level repeater data
            }
            activSecondLevelRepMenuBtn(itemData._id);
        });
    });

    thirdLevelMenuRepeater.onItemReady(($item, itemData) => {
        const mainMenuBtn = $item('#thirdLevelRepBtn');
        mainMenuBtn.label = itemData.label;

        mainMenuBtn.onMouseIn(() => {
            if (itemData.image) {
                $w('#ingredientMainImage').src = itemData.image; // Settings the relevant image
            }
            activThirdLevelRepMenuBtn(itemData._id);
        });
    });
}

//******************//
//      Styling 
//******************//
function activMainMenuBtn(hoveredBtnId) {
    $w('#mainMenuRepeater').forEachItem(($item, itemData, index) => {
        const mainMenuItem = $item('#mainMenuRepItem');

        if (itemData._id === hoveredBtnId) {
            mainMenuItem.style.backgroundColor = '#39641D'
        } else {
            mainMenuItem.style.backgroundColor = '#92B079'
        }
    });
}

function activFirstLevelRepMenuBtn(hoveredBtnId) {
    $w('#firstLevelRepeater').forEachItem(($item, itemData, index) => {
        const mainMenuItem = $item('#firstLevelRepItem');

        if (itemData._id === hoveredBtnId) {
            mainMenuItem.style.backgroundColor = '#D2E4C7'
        } else {
            mainMenuItem.style.backgroundColor = '#f3f8f000' //Transparent
        }
    });
}

function activSecondLevelRepMenuBtn(hoveredBtnId) {
    $w('#secondLevelRepeater').forEachItem(($item, itemData, index) => {
        const mainMenuItem = $item('#secondLevelRepItem');

        if (itemData._id === hoveredBtnId) {
            mainMenuItem.style.backgroundColor = '#B5CDA5'
        } else {
            mainMenuItem.style.backgroundColor = '#f3f8f000' //Transparent
        }
    });
}

function activThirdLevelRepMenuBtn(hoveredBtnId) {
    $w('#thirdLevelRepeater').forEachItem(($item, itemData, index) => {
        const mainMenuItem = $item('#thirdLevelRepItem');

        if (itemData._id === hoveredBtnId) {
            mainMenuItem.style.backgroundColor = '#9CBB82'
        } else {
            mainMenuItem.style.backgroundColor = '#f3f8f000' //Transparent
        }
    });
}